package com.test.usersapi.test.services;

import static org.junit.Assert.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

import java.io.IOException;
import java.rmi.server.ExportException;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.core.io.ByteArrayResource;
import org.springframework.core.io.Resource;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.itextpdf.text.DocumentException;
import com.test.usersapi.domains.mappings.MapExportPdf;
import com.test.usersapi.domains.mappings.MapRenderPdf;
import com.test.usersapi.domains.mappings.MapSearchResult;
import com.test.usersapi.domains.models.ExportHistory;
import com.test.usersapi.exceptions.FileStorageException;
import com.test.usersapi.exceptions.GithubApiException;
import com.test.usersapi.services.ExportHistoryService;
import com.test.usersapi.services.ExportService;
import com.test.usersapi.services.FileStorageService;
import com.test.usersapi.services.GithubApiService;
import com.test.usersapi.util.ExportPdfGenerator;

@ExtendWith(MockitoExtension.class)
public class ExportServiceTest {

	@Mock
	private GithubApiService githubApiService;

	@Mock
	private FileStorageService fileStorageService;

	@Mock
	private ExportHistoryService exportHistoryService;
	
	@Mock
	private ExportPdfGenerator exportPdfGenerator;

	@InjectMocks
	private ExportService exportService;

	@Test
	public void testExportPdf() throws ExportException, GithubApiException, IOException, DocumentException {
		// Create mock objects
		String searchQuery = "qqq&location=Indonesia&per_page=30";
		String userListJson="{\"total_count\":8338,\"incomplete_results\":false,\"items\":[{\"login\":\"q\",\"id\":65956,\"node_id\":\"MDQ6VXNlcjY1OTU2\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/65956?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/q\",\"html_url\":\"https://github.com/q\",\"followers_url\":\"https://api.github.com/users/q/followers\",\"following_url\":\"https://api.github.com/users/q/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/q/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/q/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/q/subscriptions\",\"organizations_url\":\"https://api.github.com/users/q/orgs\",\"repos_url\":\"https://api.github.com/users/q/repos\",\"events_url\":\"https://api.github.com/users/q/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/q/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"ItsJonQ\",\"id\":2322354,\"node_id\":\"MDQ6VXNlcjIzMjIzNTQ=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/2322354?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/ItsJonQ\",\"html_url\":\"https://github.com/ItsJonQ\",\"followers_url\":\"https://api.github.com/users/ItsJonQ/followers\",\"following_url\":\"https://api.github.com/users/ItsJonQ/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/ItsJonQ/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/ItsJonQ/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/ItsJonQ/subscriptions\",\"organizations_url\":\"https://api.github.com/users/ItsJonQ/orgs\",\"repos_url\":\"https://api.github.com/users/ItsJonQ/repos\",\"events_url\":\"https://api.github.com/users/ItsJonQ/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/ItsJonQ/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"turbio\",\"id\":1428207,\"node_id\":\"MDQ6VXNlcjE0MjgyMDc=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/1428207?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/turbio\",\"html_url\":\"https://github.com/turbio\",\"followers_url\":\"https://api.github.com/users/turbio/followers\",\"following_url\":\"https://api.github.com/users/turbio/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/turbio/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/turbio/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/turbio/subscriptions\",\"organizations_url\":\"https://api.github.com/users/turbio/orgs\",\"repos_url\":\"https://api.github.com/users/turbio/repos\",\"events_url\":\"https://api.github.com/users/turbio/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/turbio/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"subchen\",\"id\":2189657,\"node_id\":\"MDQ6VXNlcjIxODk2NTc=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/2189657?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/subchen\",\"html_url\":\"https://github.com/subchen\",\"followers_url\":\"https://api.github.com/users/subchen/followers\",\"following_url\":\"https://api.github.com/users/subchen/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/subchen/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/subchen/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/subchen/subscriptions\",\"organizations_url\":\"https://api.github.com/users/subchen/orgs\",\"repos_url\":\"https://api.github.com/users/subchen/repos\",\"events_url\":\"https://api.github.com/users/subchen/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/subchen/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"yydcdut\",\"id\":7722279,\"node_id\":\"MDQ6VXNlcjc3MjIyNzk=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/7722279?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/yydcdut\",\"html_url\":\"https://github.com/yydcdut\",\"followers_url\":\"https://api.github.com/users/yydcdut/followers\",\"following_url\":\"https://api.github.com/users/yydcdut/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/yydcdut/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/yydcdut/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/yydcdut/subscriptions\",\"organizations_url\":\"https://api.github.com/users/yydcdut/orgs\",\"repos_url\":\"https://api.github.com/users/yydcdut/repos\",\"events_url\":\"https://api.github.com/users/yydcdut/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/yydcdut/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"acid-chicken\",\"id\":20679825,\"node_id\":\"MDQ6VXNlcjIwNjc5ODI1\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/20679825?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/acid-chicken\",\"html_url\":\"https://github.com/acid-chicken\",\"followers_url\":\"https://api.github.com/users/acid-chicken/followers\",\"following_url\":\"https://api.github.com/users/acid-chicken/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/acid-chicken/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/acid-chicken/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/acid-chicken/subscriptions\",\"organizations_url\":\"https://api.github.com/users/acid-chicken/orgs\",\"repos_url\":\"https://api.github.com/users/acid-chicken/repos\",\"events_url\":\"https://api.github.com/users/acid-chicken/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/acid-chicken/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"lich4\",\"id\":8621719,\"node_id\":\"MDQ6VXNlcjg2MjE3MTk=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/8621719?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/lich4\",\"html_url\":\"https://github.com/lich4\",\"followers_url\":\"https://api.github.com/users/lich4/followers\",\"following_url\":\"https://api.github.com/users/lich4/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/lich4/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/lich4/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/lich4/subscriptions\",\"organizations_url\":\"https://api.github.com/users/lich4/orgs\",\"repos_url\":\"https://api.github.com/users/lich4/repos\",\"events_url\":\"https://api.github.com/users/lich4/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/lich4/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"charlesXu86\",\"id\":13271848,\"node_id\":\"MDQ6VXNlcjEzMjcxODQ4\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/13271848?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/charlesXu86\",\"html_url\":\"https://github.com/charlesXu86\",\"followers_url\":\"https://api.github.com/users/charlesXu86/followers\",\"following_url\":\"https://api.github.com/users/charlesXu86/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/charlesXu86/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/charlesXu86/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/charlesXu86/subscriptions\",\"organizations_url\":\"https://api.github.com/users/charlesXu86/orgs\",\"repos_url\":\"https://api.github.com/users/charlesXu86/repos\",\"events_url\":\"https://api.github.com/users/charlesXu86/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/charlesXu86/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"cd-glacier\",\"id\":12538942,\"node_id\":\"MDQ6VXNlcjEyNTM4OTQy\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/12538942?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/cd-glacier\",\"html_url\":\"https://github.com/cd-glacier\",\"followers_url\":\"https://api.github.com/users/cd-glacier/followers\",\"following_url\":\"https://api.github.com/users/cd-glacier/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/cd-glacier/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/cd-glacier/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/cd-glacier/subscriptions\",\"organizations_url\":\"https://api.github.com/users/cd-glacier/orgs\",\"repos_url\":\"https://api.github.com/users/cd-glacier/repos\",\"events_url\":\"https://api.github.com/users/cd-glacier/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/cd-glacier/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"ELLIOTTCABLE\",\"id\":200,\"node_id\":\"MDQ6VXNlcjIwMA==\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/200?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/ELLIOTTCABLE\",\"html_url\":\"https://github.com/ELLIOTTCABLE\",\"followers_url\":\"https://api.github.com/users/ELLIOTTCABLE/followers\",\"following_url\":\"https://api.github.com/users/ELLIOTTCABLE/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/ELLIOTTCABLE/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/ELLIOTTCABLE/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/ELLIOTTCABLE/subscriptions\",\"organizations_url\":\"https://api.github.com/users/ELLIOTTCABLE/orgs\",\"repos_url\":\"https://api.github.com/users/ELLIOTTCABLE/repos\",\"events_url\":\"https://api.github.com/users/ELLIOTTCABLE/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/ELLIOTTCABLE/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"qiurunze123\",\"id\":22807361,\"node_id\":\"MDQ6VXNlcjIyODA3MzYx\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/22807361?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/qiurunze123\",\"html_url\":\"https://github.com/qiurunze123\",\"followers_url\":\"https://api.github.com/users/qiurunze123/followers\",\"following_url\":\"https://api.github.com/users/qiurunze123/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/qiurunze123/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/qiurunze123/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/qiurunze123/subscriptions\",\"organizations_url\":\"https://api.github.com/users/qiurunze123/orgs\",\"repos_url\":\"https://api.github.com/users/qiurunze123/repos\",\"events_url\":\"https://api.github.com/users/qiurunze123/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/qiurunze123/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"TheEnbyperor\",\"id\":7520894,\"node_id\":\"MDQ6VXNlcjc1MjA4OTQ=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/7520894?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/TheEnbyperor\",\"html_url\":\"https://github.com/TheEnbyperor\",\"followers_url\":\"https://api.github.com/users/TheEnbyperor/followers\",\"following_url\":\"https://api.github.com/users/TheEnbyperor/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/TheEnbyperor/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/TheEnbyperor/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/TheEnbyperor/subscriptions\",\"organizations_url\":\"https://api.github.com/users/TheEnbyperor/orgs\",\"repos_url\":\"https://api.github.com/users/TheEnbyperor/repos\",\"events_url\":\"https://api.github.com/users/TheEnbyperor/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/TheEnbyperor/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"diutsu\",\"id\":1466703,\"node_id\":\"MDQ6VXNlcjE0NjY3MDM=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/1466703?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/diutsu\",\"html_url\":\"https://github.com/diutsu\",\"followers_url\":\"https://api.github.com/users/diutsu/followers\",\"following_url\":\"https://api.github.com/users/diutsu/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/diutsu/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/diutsu/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/diutsu/subscriptions\",\"organizations_url\":\"https://api.github.com/users/diutsu/orgs\",\"repos_url\":\"https://api.github.com/users/diutsu/repos\",\"events_url\":\"https://api.github.com/users/diutsu/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/diutsu/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"simaQ\",\"id\":6628666,\"node_id\":\"MDQ6VXNlcjY2Mjg2NjY=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/6628666?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/simaQ\",\"html_url\":\"https://github.com/simaQ\",\"followers_url\":\"https://api.github.com/users/simaQ/followers\",\"following_url\":\"https://api.github.com/users/simaQ/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/simaQ/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/simaQ/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/simaQ/subscriptions\",\"organizations_url\":\"https://api.github.com/users/simaQ/orgs\",\"repos_url\":\"https://api.github.com/users/simaQ/repos\",\"events_url\":\"https://api.github.com/users/simaQ/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/simaQ/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"Illvili\",\"id\":860588,\"node_id\":\"MDQ6VXNlcjg2MDU4OA==\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/860588?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/Illvili\",\"html_url\":\"https://github.com/Illvili\",\"followers_url\":\"https://api.github.com/users/Illvili/followers\",\"following_url\":\"https://api.github.com/users/Illvili/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/Illvili/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/Illvili/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/Illvili/subscriptions\",\"organizations_url\":\"https://api.github.com/users/Illvili/orgs\",\"repos_url\":\"https://api.github.com/users/Illvili/repos\",\"events_url\":\"https://api.github.com/users/Illvili/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/Illvili/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"Qengineering\",\"id\":44409029,\"node_id\":\"MDQ6VXNlcjQ0NDA5MDI5\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/44409029?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/Qengineering\",\"html_url\":\"https://github.com/Qengineering\",\"followers_url\":\"https://api.github.com/users/Qengineering/followers\",\"following_url\":\"https://api.github.com/users/Qengineering/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/Qengineering/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/Qengineering/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/Qengineering/subscriptions\",\"organizations_url\":\"https://api.github.com/users/Qengineering/orgs\",\"repos_url\":\"https://api.github.com/users/Qengineering/repos\",\"events_url\":\"https://api.github.com/users/Qengineering/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/Qengineering/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"qdot\",\"id\":34539,\"node_id\":\"MDQ6VXNlcjM0NTM5\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/34539?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/qdot\",\"html_url\":\"https://github.com/qdot\",\"followers_url\":\"https://api.github.com/users/qdot/followers\",\"following_url\":\"https://api.github.com/users/qdot/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/qdot/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/qdot/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/qdot/subscriptions\",\"organizations_url\":\"https://api.github.com/users/qdot/orgs\",\"repos_url\":\"https://api.github.com/users/qdot/repos\",\"events_url\":\"https://api.github.com/users/qdot/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/qdot/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"danielkrizian\",\"id\":2865860,\"node_id\":\"MDQ6VXNlcjI4NjU4NjA=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/2865860?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/danielkrizian\",\"html_url\":\"https://github.com/danielkrizian\",\"followers_url\":\"https://api.github.com/users/danielkrizian/followers\",\"following_url\":\"https://api.github.com/users/danielkrizian/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/danielkrizian/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/danielkrizian/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/danielkrizian/subscriptions\",\"organizations_url\":\"https://api.github.com/users/danielkrizian/orgs\",\"repos_url\":\"https://api.github.com/users/danielkrizian/repos\",\"events_url\":\"https://api.github.com/users/danielkrizian/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/danielkrizian/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"kyleap\",\"id\":8849818,\"node_id\":\"MDQ6VXNlcjg4NDk4MTg=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/8849818?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/kyleap\",\"html_url\":\"https://github.com/kyleap\",\"followers_url\":\"https://api.github.com/users/kyleap/followers\",\"following_url\":\"https://api.github.com/users/kyleap/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/kyleap/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/kyleap/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/kyleap/subscriptions\",\"organizations_url\":\"https://api.github.com/users/kyleap/orgs\",\"repos_url\":\"https://api.github.com/users/kyleap/repos\",\"events_url\":\"https://api.github.com/users/kyleap/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/kyleap/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"qyuhen\",\"id\":465305,\"node_id\":\"MDQ6VXNlcjQ2NTMwNQ==\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/465305?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/qyuhen\",\"html_url\":\"https://github.com/qyuhen\",\"followers_url\":\"https://api.github.com/users/qyuhen/followers\",\"following_url\":\"https://api.github.com/users/qyuhen/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/qyuhen/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/qyuhen/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/qyuhen/subscriptions\",\"organizations_url\":\"https://api.github.com/users/qyuhen/orgs\",\"repos_url\":\"https://api.github.com/users/qyuhen/repos\",\"events_url\":\"https://api.github.com/users/qyuhen/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/qyuhen/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"arnabwahid\",\"id\":9797305,\"node_id\":\"MDQ6VXNlcjk3OTczMDU=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/9797305?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/arnabwahid\",\"html_url\":\"https://github.com/arnabwahid\",\"followers_url\":\"https://api.github.com/users/arnabwahid/followers\",\"following_url\":\"https://api.github.com/users/arnabwahid/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/arnabwahid/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/arnabwahid/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/arnabwahid/subscriptions\",\"organizations_url\":\"https://api.github.com/users/arnabwahid/orgs\",\"repos_url\":\"https://api.github.com/users/arnabwahid/repos\",\"events_url\":\"https://api.github.com/users/arnabwahid/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/arnabwahid/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"Fematich\",\"id\":4212658,\"node_id\":\"MDQ6VXNlcjQyMTI2NTg=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/4212658?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/Fematich\",\"html_url\":\"https://github.com/Fematich\",\"followers_url\":\"https://api.github.com/users/Fematich/followers\",\"following_url\":\"https://api.github.com/users/Fematich/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/Fematich/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/Fematich/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/Fematich/subscriptions\",\"organizations_url\":\"https://api.github.com/users/Fematich/orgs\",\"repos_url\":\"https://api.github.com/users/Fematich/repos\",\"events_url\":\"https://api.github.com/users/Fematich/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/Fematich/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"Jannchie\",\"id\":29743310,\"node_id\":\"MDQ6VXNlcjI5NzQzMzEw\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/29743310?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/Jannchie\",\"html_url\":\"https://github.com/Jannchie\",\"followers_url\":\"https://api.github.com/users/Jannchie/followers\",\"following_url\":\"https://api.github.com/users/Jannchie/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/Jannchie/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/Jannchie/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/Jannchie/subscriptions\",\"organizations_url\":\"https://api.github.com/users/Jannchie/orgs\",\"repos_url\":\"https://api.github.com/users/Jannchie/repos\",\"events_url\":\"https://api.github.com/users/Jannchie/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/Jannchie/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"jamesqquick\",\"id\":5391915,\"node_id\":\"MDQ6VXNlcjUzOTE5MTU=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/5391915?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/jamesqquick\",\"html_url\":\"https://github.com/jamesqquick\",\"followers_url\":\"https://api.github.com/users/jamesqquick/followers\",\"following_url\":\"https://api.github.com/users/jamesqquick/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/jamesqquick/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/jamesqquick/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/jamesqquick/subscriptions\",\"organizations_url\":\"https://api.github.com/users/jamesqquick/orgs\",\"repos_url\":\"https://api.github.com/users/jamesqquick/repos\",\"events_url\":\"https://api.github.com/users/jamesqquick/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/jamesqquick/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"cuijinyu\",\"id\":22697021,\"node_id\":\"MDQ6VXNlcjIyNjk3MDIx\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/22697021?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/cuijinyu\",\"html_url\":\"https://github.com/cuijinyu\",\"followers_url\":\"https://api.github.com/users/cuijinyu/followers\",\"following_url\":\"https://api.github.com/users/cuijinyu/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/cuijinyu/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/cuijinyu/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/cuijinyu/subscriptions\",\"organizations_url\":\"https://api.github.com/users/cuijinyu/orgs\",\"repos_url\":\"https://api.github.com/users/cuijinyu/repos\",\"events_url\":\"https://api.github.com/users/cuijinyu/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/cuijinyu/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"sn00pyd0g3\",\"id\":22652335,\"node_id\":\"MDQ6VXNlcjIyNjUyMzM1\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/22652335?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/sn00pyd0g3\",\"html_url\":\"https://github.com/sn00pyd0g3\",\"followers_url\":\"https://api.github.com/users/sn00pyd0g3/followers\",\"following_url\":\"https://api.github.com/users/sn00pyd0g3/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/sn00pyd0g3/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/sn00pyd0g3/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/sn00pyd0g3/subscriptions\",\"organizations_url\":\"https://api.github.com/users/sn00pyd0g3/orgs\",\"repos_url\":\"https://api.github.com/users/sn00pyd0g3/repos\",\"events_url\":\"https://api.github.com/users/sn00pyd0g3/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/sn00pyd0g3/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"muellerberndt\",\"id\":5194767,\"node_id\":\"MDQ6VXNlcjUxOTQ3Njc=\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/5194767?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/muellerberndt\",\"html_url\":\"https://github.com/muellerberndt\",\"followers_url\":\"https://api.github.com/users/muellerberndt/followers\",\"following_url\":\"https://api.github.com/users/muellerberndt/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/muellerberndt/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/muellerberndt/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/muellerberndt/subscriptions\",\"organizations_url\":\"https://api.github.com/users/muellerberndt/orgs\",\"repos_url\":\"https://api.github.com/users/muellerberndt/repos\",\"events_url\":\"https://api.github.com/users/muellerberndt/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/muellerberndt/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"a458167371\",\"id\":19208223,\"node_id\":\"MDQ6VXNlcjE5MjA4MjIz\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/19208223?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/a458167371\",\"html_url\":\"https://github.com/a458167371\",\"followers_url\":\"https://api.github.com/users/a458167371/followers\",\"following_url\":\"https://api.github.com/users/a458167371/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/a458167371/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/a458167371/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/a458167371/subscriptions\",\"organizations_url\":\"https://api.github.com/users/a458167371/orgs\",\"repos_url\":\"https://api.github.com/users/a458167371/repos\",\"events_url\":\"https://api.github.com/users/a458167371/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/a458167371/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"Bijikyu\",\"id\":28985587,\"node_id\":\"MDQ6VXNlcjI4OTg1NTg3\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/28985587?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/Bijikyu\",\"html_url\":\"https://github.com/Bijikyu\",\"followers_url\":\"https://api.github.com/users/Bijikyu/followers\",\"following_url\":\"https://api.github.com/users/Bijikyu/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/Bijikyu/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/Bijikyu/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/Bijikyu/subscriptions\",\"organizations_url\":\"https://api.github.com/users/Bijikyu/orgs\",\"repos_url\":\"https://api.github.com/users/Bijikyu/repos\",\"events_url\":\"https://api.github.com/users/Bijikyu/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/Bijikyu/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0},{\"login\":\"bitmage\",\"id\":312943,\"node_id\":\"MDQ6VXNlcjMxMjk0Mw==\",\"avatar_url\":\"https://avatars.githubusercontent.com/u/312943?v=4\",\"gravatar_id\":\"\",\"url\":\"https://api.github.com/users/bitmage\",\"html_url\":\"https://github.com/bitmage\",\"followers_url\":\"https://api.github.com/users/bitmage/followers\",\"following_url\":\"https://api.github.com/users/bitmage/following{/other_user}\",\"gists_url\":\"https://api.github.com/users/bitmage/gists{/gist_id}\",\"starred_url\":\"https://api.github.com/users/bitmage/starred{/owner}{/repo}\",\"subscriptions_url\":\"https://api.github.com/users/bitmage/subscriptions\",\"organizations_url\":\"https://api.github.com/users/bitmage/orgs\",\"repos_url\":\"https://api.github.com/users/bitmage/repos\",\"events_url\":\"https://api.github.com/users/bitmage/events{/privacy}\",\"received_events_url\":\"https://api.github.com/users/bitmage/received_events\",\"type\":\"User\",\"site_admin\":false,\"score\":1.0}]}\r\n";
		byte[] pdfBytes = "pdf content".getBytes();
		String uniqueFileName="uniqueFileName";

		ObjectMapper mapper = new ObjectMapper();
		MapSearchResult searchResult = mapper.readValue(userListJson, MapSearchResult.class);
		MapRenderPdf renderResult = new MapRenderPdf();
		renderResult.setSearchResult(searchResult);
		renderResult.setPdfBytes(pdfBytes);
		Resource resource = new ByteArrayResource(pdfBytes);
		when(githubApiService.searchUsers(searchQuery)).thenReturn(userListJson);
		when(exportPdfGenerator.renderPdf(searchQuery, userListJson)).thenReturn(renderResult);
		when(fileStorageService.saveFile(eq(pdfBytes), any(String.class))).thenReturn(uniqueFileName);

		// Call the method being tested
		MapExportPdf exportResult = exportService.exportPdf(searchQuery);

		// Verify results
		assertNotNull(exportResult.getFileName());
		assertEquals(MapExportPdf.STATUS_OK, exportResult.getStatus());
		assertEquals(String.format(MapExportPdf.MESSAGE_RECORD_FOUND_STRING_FORMAT, 30), exportResult.getMessage());
		assertEquals(pdfBytes.length, exportResult.getRenderPdf().getPdfBytes().length);
		verify(exportPdfGenerator).renderPdf(searchQuery, userListJson);
		verify(fileStorageService).saveFile(eq(pdfBytes), any(String.class));
		verify(exportHistoryService).add(any(ExportHistory.class));
	}

	@Test
	public void testDownloadPdf() throws FileStorageException, IOException {
		// Create mock objects
		String fileName = "uniqueFileName";
		byte[] pdfBytes = "pdf content".getBytes();
		Resource resource = new ByteArrayResource(pdfBytes);
		when(fileStorageService.loadFileAsResource(fileName)).thenReturn(resource);

		// Call the method being tested
		Resource result = exportService.downloadPdf(fileName);

		// Verify results
		assertNotNull(result);
		assertEquals(pdfBytes.length, result.contentLength());
		assertEquals(resource.getFilename(), result.getFilename());
		verify(fileStorageService).loadFileAsResource(fileName);
	}
}

